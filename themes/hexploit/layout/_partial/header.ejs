<header class="bg-transparent text-hacker-white py-2 font-dos font-extrabold relative z-50">
  <!-- Responsive Header Layout:
       - Desktop/Laptop (>=1024px): Title left, Navigation items + Search right.
       - Mobile/Tablet (<1024px): Hamburger left, Title center, Search right.
  -->
  
  <!-- MOBILE HEADER (visible below 1024px) -->
  <div class="mobile-header items-center justify-between px-4 h-14">
    <!-- Left: Hamburger Menu -->
    <button id="menu-toggle" class="text-hacker-color1 hover:text-white focus:outline-none p-2 z-50">
      <i class="fas fa-bars text-2xl"></i>
    </button>

    <!-- Center: Site Title -->
    <h1 class="text-lg font-bold text-hacker-color1 whitespace-nowrap m-0 p-0 leading-none z-50">
      <a href="/" class="hover:text-white transition-colors select-none">
        <%= config.title %>
      </a>
    </h1>

    <!-- Right: Search Button -->
    <button id="search-toggle-mobile" class="text-hacker-color1 hover:text-white focus:outline-none p-2 z-50">
      <i class="fas fa-search text-xl"></i>
    </button>
  </div>

  <!-- DESKTOP/LAPTOP HEADER (visible at 1024px and above) -->
  <nav class="desktop-header">
    
    <!-- Left: Site Title -->
    <div class="flex-shrink-0">
      <h1 class="text-2xl font-bold text-hacker-color1 whitespace-nowrap m-0 p-0 leading-none">
        <a href="/" class="hover:text-white transition-colors select-none" style="display: flex; align-items: center;">
          <i class="fas fa-terminal" style="margin-right: 8px;"></i>
          <%= config.title %>
        </a>
      </h1>
    </div>

    <!-- Right: Navigation Items + Search -->
    <div style="display: flex; align-items: center; margin-left: auto;">
      <% 
        // Determine current path for active state
        const currentPath = page.path ? '/' + page.path.replace(/index\.html$/, '') : '/';
      %>
      
      <% for (let item of theme.menu) { %>
        <% 
          // Check if this menu item is active
          const itemPath = item.url.endsWith('/') ? item.url : item.url + '/';
          const isActive = currentPath === item.url || currentPath === itemPath || 
                           (item.url === '/' && (currentPath === '/' || currentPath === '/index.html')) ||
                           (item.url === '/tags' && currentPath.startsWith('/tags'));
        %>
        <a href="<%= item.url %>"
          class="nav-link text-hacker-color3 hover:text-hacker-color1 transition-colors font-dos <%= isActive ? 'nav-active' : '' %>"
          style="display: flex; align-items: center; padding: 8px 16px; font-size: 1rem;"
          <%= item.url.startsWith('http') || item.url.startsWith('mailto:') ? 'target="_blank" rel="noopener noreferrer"' : '' %>>
          <i class="fas fa-<%= item.name.toLowerCase() === 'home' ? 'home' : (item.name.toLowerCase() === 'about' ? 'user' : (item.name.toLowerCase() === 'tags' ? 'tags' : (item.name.toLowerCase() === 'contact' ? 'envelope' : 'circle'))) %>" style="margin-right: 6px;"></i>
          <span><%= item.name %></span>
        </a>
      <% } %>

      <!-- Search Button -->
      <button id="search-toggle" class="text-hacker-color1 hover:text-white focus:outline-none" style="padding: 8px; margin-left: 24px;">
        <i class="fas fa-search" style="font-size: 1.25rem;"></i>
      </button>
    </div>
  </nav>

  <!-- Mobile Slide-out Menu (Right Side) -->
  <div id="mobile-menu-overlay"></div>

  <nav id="mobile-menu">
    <!-- Sidebar Header -->
    <div class="sidebar-header text-center mb-8">
      <img src="https://ui-avatars.com/api/?name=<%= config.author %>&background=00ff00&color=000&size=128" alt="Avatar"
        class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-hacker-color1 p-1">
      <h2 class="text-2xl text-hacker-color1 font-bold">
        <%= config.title %>
      </h2>
      <p class="text-hacker-color3 text-sm mt-2">
        <%= config.subtitle %>
      </p>
    </div>

    <!-- Menu Items -->
    <ul class="space-y-4 w-full px-4">
      <% for (let item of theme.menu) { %>
        <% 
          const itemPath = item.url.endsWith('/') ? item.url : item.url + '/';
          const isActiveMobile = currentPath === item.url || currentPath === itemPath || 
                           (item.url === '/' && (currentPath === '/' || currentPath === '/index.html')) ||
                           (item.url === '/tags' && currentPath.startsWith('/tags'));
        %>
        <li>
          <a href="<%= item.url %>"
            class="flex items-center space-x-4 text-xl transition-colors font-dos p-2 rounded hover:bg-white/5 <%= isActiveMobile ? 'text-hacker-color1 bg-white/5' : 'text-hacker-color3 hover:text-hacker-color1' %>"
            <%= item.url.startsWith('http') || item.url.startsWith('mailto:') ? 'target="_blank" rel="noopener noreferrer"' : '' %>>
            <i class="fas fa-<%= item.name.toLowerCase() === 'home' ? 'home' : (item.name.toLowerCase() === 'about' ? 'user' : (item.name.toLowerCase() === 'tags' ? 'tags' : (item.name.toLowerCase() === 'contact' ? 'envelope' : 'circle'))) %> w-8 text-center"></i>
            <span><%= item.name %></span>
          </a>
        </li>
      <% } %>

          <!-- Extra Links from Sidebar Config -->
          <% if (theme.sidebar && theme.sidebar.links) { %>
            <li class="border-t border-gray-700 my-4"></li>
            <% for (let link of theme.sidebar.links) { %>
              <li>
                <a href="<%= link.url %>"
                  class="flex items-center space-x-4 text-lg text-hacker-color3 hover:text-hacker-color1 transition-colors font-dos p-2 rounded hover:bg-white/5">
                  <i
                    class="fas fa-<%= link.name.toLowerCase() === 'github' ? 'github' : (link.name.toLowerCase() === 'email' ? 'envelope' : 'external-link-alt') %> w-8 text-center"></i>
                  <span>
                    <%= link.name %>
                  </span>
                </a>
              </li>
              <% } %>
                <% } %>
    </ul>

    <!-- Social Icons Footer -->
    <div class="mt-auto pt-8 flex justify-center space-x-6">
      <!-- Add some default socials if not in config, or just rely on sidebar links -->
    </div>
  </nav>

  <!-- Search Overlay - Compact Dark Theme -->
  <div id="search-overlay" class="search-dropdown hidden">
    <div class="search-container">
      <div class="search-input-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="search-input" placeholder="Search posts..." autocomplete="off">
        <button id="search-close" class="search-close-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="search-results" class="search-results"></div>
    </div>
  </div>

  <!-- RSS Link -->
  <link rel="alternate" type="application/rss+xml" title="<%= theme.title %> RSS" href="<%= config.root %>rss.xml" />
</header>
<script src="/js/search.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Menu Logic
    const menuToggle = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const overlay = document.getElementById("mobile-menu-overlay");
    let isMenuOpen = false;

    function toggleMenu() {
      isMenuOpen = !isMenuOpen;
      if (isMenuOpen) {
        mobileMenu.classList.add("open");
        overlay.classList.add("open");
      } else {
        mobileMenu.classList.remove("open");
        overlay.classList.remove("open");
      }
    }

    menuToggle.addEventListener("click", toggleMenu);
    overlay.addEventListener("click", toggleMenu);

    // Search Logic
    const searchToggle = document.getElementById("search-toggle");
    const searchToggleMobile = document.getElementById("search-toggle-mobile");
    const searchOverlay = document.getElementById("search-overlay");
    const searchClose = document.getElementById("search-close");
    const searchInput = document.getElementById("search-input");

    function toggleSearch() {
      if (searchOverlay.classList.contains("hidden")) {
        searchOverlay.classList.remove("hidden");
        searchInput.focus();
      } else {
        searchOverlay.classList.add("hidden");
      }
    }

    if (searchToggle) searchToggle.addEventListener("click", toggleSearch);
    if (searchToggleMobile) searchToggleMobile.addEventListener("click", toggleSearch);
    searchClose.addEventListener("click", toggleSearch);

    // Close search on Escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !searchOverlay.classList.contains("hidden")) {
        toggleSearch();
      }
    });
  });
</script>