<header class="site-header fixed top-0 left-0 right-0 bg-transparent text-hacker-white py-2 font-dos font-extrabold z-50">
  <%
    /* SAFE VARIABLES (Hexo-compatible) */
    var currentPath = page.path ? '/' + page.path.replace(/index\.html$/, '') : '/';
    var menu = [];
    
    /* Try multiple ways to access menu config */
    if (theme && Array.isArray(theme.menu)) {
      menu = theme.menu;
    } else if (config && config.theme_config && Array.isArray(config.theme_config.menu)) {
      menu = config.theme_config.menu;
    }
    
    /* Fallback hardcoded menu if config fails */
    if (!menu || menu.length === 0) {
      menu = [
        { name: 'Home', url: '/' },
        { name: 'About', url: '/about/' },
        { name: 'Tags', url: '/tags/' },
        { name: 'Contact', url: '/contact/' }
      ];
    }
  %>

  <!-- MOBILE HEADER (below 1024px) -->
  <div class="mobile-header items-center justify-between px-4 h-14">
    <button id="menu-toggle" class="text-hacker-color1 hover:text-white focus:outline-none p-2 z-50">
      <i class="fas fa-bars text-2xl"></i>
    </button>

    <h1 class="text-lg font-bold text-hacker-color1 whitespace-nowrap m-0 p-0 leading-none z-50">
      <a href="/" class="hover:text-white transition-colors select-none">
        <%= config.title %>
      </a>
    </h1>
    
    <button id="search-toggle-mobile" class="text-hacker-color1 hover:text-white focus:outline-none p-2 z-50">
      <i class="fas fa-search text-xl"></i>
    </button>
  </div>

  <!-- DESKTOP HEADER (1024px and above) -->
  <nav class="desktop-header hidden lg:flex items-center w-full">


    <!-- LEFT: Site Title -->
    <div class="flex-shrink-0">
      <h1 class="text-2xl font-bold text-hacker-color1 whitespace-nowrap m-0 p-0 leading-none">
        <a href="/" class="hover:text-white transition-colors select-none" style="display: flex; align-items: center;">
          <i class="fas fa-terminal" style="margin-right: 8px;"></i>
          <%= config.title %>
        </a>
      </h1>
    </div>

    <!-- RIGHT: Navigation + Search -->
    <div style="display: flex; align-items: center; margin-left: auto;">

      <% if (menu.length) { %>
        <% menu.forEach(function(item) { %>
          <%
            var itemPath = item.url.endsWith('/') ? item.url : item.url + '/';
            var isActive =
              currentPath === item.url ||
              currentPath === itemPath ||
              (item.url === '/' && currentPath === '/') ||
              (item.url === '/tags' && currentPath.indexOf('/tags') === 0);
          %>

          <a href="<%= item.url %>"
             class="nav-link text-hacker-color3 hover:text-hacker-color1 transition-colors font-dos <%= isActive ? 'nav-active' : '' %>"
             style="display: flex; align-items: center; padding: 8px 16px; font-size: 1rem;"
             <%= item.url.indexOf('http') === 0 || item.url.indexOf('mailto:') === 0 ? 'target="_blank" rel="noopener noreferrer"' : '' %>>
            <i class="fas fa-<%= item.name.toLowerCase() === 'home' ? 'home' : (item.name.toLowerCase() === 'about' ? 'user' : (item.name.toLowerCase() === 'tags' ? 'tags' : (item.name.toLowerCase() === 'contact' ? 'envelope' : 'circle'))) %>" style="margin-right: 6px;"></i>
            <span><%= item.name %></span>
          </a>
        <% }) %>
      <% } %>

      <button id="search-toggle" class="text-hacker-color1 hover:text-white focus:outline-none" style="padding: 8px; margin-left: 24px;">
        <i class="fas fa-search" style="font-size: 1.25rem;"></i>
      </button>
    </div>
  </nav>

  <!-- MOBILE SLIDE MENU -->
  <div id="mobile-menu-overlay"></div>

  <nav id="mobile-menu">
    <!-- Sidebar Header with Profile Photo -->
    <div class="sidebar-header text-center mb-6 pt-4">
      <div class="profile-glow">
        <img src="/img/my-photo.jpeg" alt="Profile"
          class="profile-photo w-20 h-20 rounded-full mx-auto mb-3 border-2 border-hacker-color1 p-1 object-cover">
      </div>
      <h2 class="text-xl text-hacker-color1 font-bold font-dos glitch-text">
        <%= config.title %>
      </h2>
      <p class="text-hacker-color3 text-sm mt-1 font-dos typing-text">
        <%= config.subtitle %>
      </p>
    </div>

    <ul class="mobile-nav-list space-y-2 w-full px-4">

      <% if (menu.length) { %>
        <% var menuIcons = { 'Home': 'fa-terminal', 'About': 'fa-user-secret', 'Tags': 'fa-tags', 'Contact': 'fa-envelope', 'Blog': 'fa-blog', 'Archives': 'fa-archive', 'Categories': 'fa-folder' }; %>
        <% menu.forEach(function(item, index) { %>
          <li class="mobile-nav-item" style="--item-index: <%= index %>;">
            <a href="<%= item.url %>"
              class="mobile-nav-link flex items-center space-x-4 text-xl transition-colors font-dos p-3 rounded-lg"
              <%= item.url.indexOf('http') === 0 || item.url.indexOf('mailto:') === 0 ? 'target="_blank" rel="noopener noreferrer"' : '' %>>
              <span class="nav-icon-wrapper">
                <i class="fas <%= menuIcons[item.name] || 'fa-chevron-right' %>"></i>
              </span>
              <span class="nav-text"><%= item.name %></span>
              <span class="nav-arrow"><i class="fas fa-angle-right"></i></span>
            </a>
          </li>
        <% }) %>
      <% } %>

      <% if (theme.sidebar && Array.isArray(theme.sidebar.links) && theme.sidebar.links.length > 0) { %>
        <li class="mobile-nav-divider"></li>
        <% var socialIcons = { 'GitHub': 'fa-github', 'Twitter': 'fa-twitter', 'LinkedIn': 'fa-linkedin', 'Email': 'fa-envelope', 'Discord': 'fa-discord', 'YouTube': 'fa-youtube', 'Instagram': 'fa-instagram' }; %>
        <% theme.sidebar.links.forEach(function(link, index) { %>
          <li class="mobile-nav-item" style="--item-index: <%= menu.length + index + 1 %>;">
            <a href="<%= link.url %>"
               class="mobile-nav-link flex items-center space-x-4 text-lg transition-colors font-dos p-3 rounded-lg"
               target="_blank" rel="noopener noreferrer">
              <span class="nav-icon-wrapper social">
                <i class="fab <%= socialIcons[link.name] || 'fa-link' %>"></i>
              </span>
              <span class="nav-text"><%= link.name %></span>
              <span class="nav-arrow"><i class="fas fa-external-link-alt"></i></span>
            </a>
          </li>
        <% }) %>
      <% } %>

    </ul>
    
    <!-- Bottom decoration -->
    <div class="mobile-menu-footer">
      <div class="scan-line"></div>
      <p class="font-dos text-xs text-hacker-color3 opacity-50">[ SYSTEM READY ]</p>
    </div>
  </nav>

  <!-- Search Overlay - Compact Dark Theme -->
  <div id="search-overlay" class="search-dropdown hidden">
    <div class="search-container">
      <div class="search-input-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="search-input" placeholder="Search posts..." autocomplete="off">
        <button id="search-close" class="search-close-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="search-results" class="search-results"></div>
    </div>
  </div>
</header>

<script src="/js/search.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Menu Logic
    var menuToggle = document.getElementById("menu-toggle");
    var mobileMenu = document.getElementById("mobile-menu");
    var overlay = document.getElementById("mobile-menu-overlay");
    var isMenuOpen = false;

    function toggleMenu() {
      isMenuOpen = !isMenuOpen;
      if (isMenuOpen) {
        mobileMenu.classList.add("open");
        overlay.classList.add("open");
        document.body.classList.add("no-scroll");
      } else {
        mobileMenu.classList.remove("open");
        overlay.classList.remove("open");
        document.body.classList.remove("no-scroll");
      }
    }

    if (menuToggle) menuToggle.addEventListener("click", toggleMenu);
    if (overlay) overlay.addEventListener("click", toggleMenu);

    // Search Logic
    var searchToggle = document.getElementById("search-toggle");
    var searchToggleMobile = document.getElementById("search-toggle-mobile");
    var searchOverlay = document.getElementById("search-overlay");
    var searchClose = document.getElementById("search-close");
    var searchInput = document.getElementById("search-input");

    function toggleSearch() {
      if (!searchOverlay) return;
      if (searchOverlay.classList.contains("hidden")) {
        searchOverlay.classList.remove("hidden");
        if (searchInput) searchInput.focus();
      } else {
        searchOverlay.classList.add("hidden");
      }
    }

    if (searchToggle) searchToggle.addEventListener("click", toggleSearch);
    if (searchToggleMobile) searchToggleMobile.addEventListener("click", toggleSearch);
    if (searchClose) searchClose.addEventListener("click", toggleSearch);

    // Close search on Escape key
    document.addEventListener("keydown", function(e) {
      if (e.key === "Escape" && searchOverlay && !searchOverlay.classList.contains("hidden")) {
        toggleSearch();
      }
    });
  });
</script>

