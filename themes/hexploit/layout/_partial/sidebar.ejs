<%
  // Use var instead of const to avoid redeclaration errors
  var sidebar = (theme && theme.sidebar) ? theme.sidebar : null;
%>

<% if (sidebar && sidebar.enable === true) { %>
  <div class="sidebar-container w-1/3 hidden md:block space-y-4 mt-8">

    <% if (Array.isArray(sidebar.widgets)) { %>
      <% (theme.sidebar.widgets || []).forEach(widget => { %>

        <!-- SEARCH -->
        <% if (widget === "search") { %>
          <input
            type="text"
            id="search-input"
            placeholder="Search..."
            class="w-full p-2.5 text-lg mb-5 border-2 border-line-color rounded bg-black text-white placeholder-gray-400"
          />
          <div id="search-results"></div>
        <% } %>

        <!-- NOTICE -->
        <% if (
          widget === "notice" &&
          sidebar.notice &&
          sidebar.notice.enable === true &&
          sidebar.notice.content
        ) { %>
          <div class="text-white p-4 rounded-md border-2 border-dashed border-line-color mb-4">
            <h3 class="font-bold text-lg text-hacker-color1">Notice</h3>
            <p class="mt-4"><%- sidebar.notice.content %></p>
          </div>
        <% } %>

        <!-- CATEGORIES -->
        <% if (widget === "categories" && site.categories && site.categories.length) { %>
          <h3 class="text-hacker-color1 font-bold text-lg">Categories</h3>
          <div>
            <% var catLimit = (sidebar.numlimit && sidebar.numlimit.categories) || 5; %>
            <% site.categories.slice(0, catLimit).forEach(function(category) { %>
              <a
                href="<%= config.url + '/' + category.path %>"
                class="text-hacker-color3 hover:text-white"
              >
                <%= category.name %> (<%= category.length %>)
              </a><br />
            <% }) %>

            <% if (site.categories.length > catLimit) { %>
              <a href="/categories" class="text-hacker-color3 hover:text-white">
                ... <%= site.categories.length - catLimit %> more
              </a>
            <% } %>
          </div>
          <hr class="w-full border-t-2 border-line-color border-dashed">
        <% } %>

        <!-- TAGS -->
        <% if (widget === "tags" && site.tags && site.tags.length) { %>
          <h3 class="text-hacker-color1 font-bold text-lg">Tags</h3>
          <div class="flex flex-wrap">
            <% var tagLimit = (sidebar.numlimit && sidebar.numlimit.tags) || 10; %>
            <% site.tags.slice(0, tagLimit).forEach(function(tag) { %>
              <a
                href="<%= config.url + '/' + tag.path %>"
                class="text-hacker-color3 hover:bg-hacker-hover-color hover:text-white block border border-hacker-color3 rounded-sm py-0.5 px-2 mr-2 mb-2"
              >
                <%= tag.name %> <sub><%= tag.length %></sub>
              </a>
            <% }) %>

            <% if (site.tags.length > tagLimit) { %>
              <a href="/tags" class="text-hacker-color3 hover:text-white">
                ... <%= site.tags.length - tagLimit %> more
              </a>
            <% } %>
          </div>
          <hr class="w-full border-t-2 border-line-color border-dashed">
        <% } %>

        <!-- LINKS -->
        <% if (widget === "links" && Array.isArray(sidebar.links)) { %>
          <h3 class="text-hacker-color1 font-bold text-lg">Links</h3>
          <div>
            <% sidebar.links.forEach(function(link) { %>
              <a
                href="<%= link.url %>"
                target="_blank"
                rel="noopener noreferrer"
                class="text-hacker-color3 hover:text-white"
              >
                <%= link.name %>
              </a><br />
            <% }) %>
          </div>
          <hr class="w-full border-t-2 border-line-color border-dashed">
        <% } %>

      <% }) %>
    <% } %>

  </div>
<% } %>
